version: 1
name: tdln-policy
backend: { mode: in-process }
pipeline:
  - use: cap-intake
    with: { map: { data: "@inputs.payload" } }
  - use: cap-policy
    with: { refs: [{ cid: "bafyPolicy..." }], fail_on_violation: true }
  - use: cap-enrich
    with: { produce: [{ kind: html, template: "receipts/report.html" }, { kind: json }] }
  - use: cap-transport
    with: { publish: ["receipt","artifacts"] }
outputs: { format: "json", fields: ["decision","receipt_cid","url_rica","artifacts"] }
