{
  "v": "product-v1",
  "name": "passport-demo",
  "version": "1.0.0",
  "pipeline": [
    {
      "step_id": "normalize",
      "kind": "cap-intake",
      "version": "^1.1",
      "config": {
        "defaults": { "ctx.kind": "transaction" },
        "mapping": [
          { "from": "req.body.user.id", "to": "ctx.user.id" },
          { "from": "req.body.score_scaled", "to": "decision.metrics.risk_score" }
        ]
      }
    },
    {
      "step_id": "policy",
      "kind": "cap-policy",
      "version": "^1.2",
      "config": {
        "decision_on_fail": "DENY",
        "rules": [
          { "kind": "EXIST", "paths": ["ctx.user.id", "ctx.kind"] },
          { "kind": "THRESHOLD_RANGE", "path": "decision.metrics.risk_score", "min": 700, "max": 900 },
          { "kind": "NOT", "rule": { "kind": "ALLOWLIST", "path": "ctx.user.id", "values": ["banned-001"] } }
        ]
      }
    },
    {
      "step_id": "enrich",
      "kind": "cap-enrich",
      "version": "^1.0",
      "config": {
        "drivers": [
          { "kind": "status-page" },
          { "kind": "webhook" }
        ],
        "redaction": ["req.headers.authorization"],
        "webhook_binding": "WH_SEC"
      }
    }
  ],
  "io_bindings": {
    "webhook.url": "https://api.client.com/hooks",
    "WH_SEC": "supersecret",
    "status.dir": "/var/www/status"
  }
}
