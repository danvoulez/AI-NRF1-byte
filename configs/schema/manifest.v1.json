{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "tdln manifest v1",
  "type": "object",
  "properties": {
    "version": { "const": 1 },
    "name": { "type": "string", "minLength": 1 },
    "backend": {
      "type": "object",
      "properties": {
        "mode": { "enum": ["in-process", "registry"] },
        "registry_base": { "type": "string", "format": "uri" }
      },
      "additionalProperties": false
    },
    "includes": { "type": "array", "items": { "type": "string" }, "maxItems": 16 },
    "vars": { "type": "object" },
    "pipeline": {
      "type": "array",
      "minItems": 1,
      "maxItems": 64,
      "items": {
        "type": "object",
        "properties": {
          "use": { "type": "string", "minLength": 1 },
          "when": { "type": "string" },
          "with": {}
        },
        "required": ["use"],
        "additionalProperties": false
      }
    },
    "outputs": {
      "type": "object",
      "properties": {
        "format": { "enum": ["json", "capsule"] },
        "fields": { "type": "array", "items": { "type": "string" }, "maxItems": 64 }
      },
      "additionalProperties": false
    }
  },
  "required": ["version", "name", "pipeline"],
  "additionalProperties": false
}
