version: 1
name: tdln-policy
backend: { mode: in-process }
pipeline:
  - use: cap-intake
    with:
      mapping:
        - { from: "data", to: "payload" }
  - use: cap-policy
    with:
      rules:
        - { kind: "EXIST", paths: ["payload"] }
      decision_on_fail: "DENY"
  - use: cap-enrich
    with:
      drivers:
        - { kind: "status-page" }
  - use: cap-transport
    with:
      node: "did:ubl:tdln-policy#key-1"
outputs: { format: "json", fields: ["decision","receipt_cid","url_rica","artifacts"] }
