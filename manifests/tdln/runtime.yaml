version: 1
name: tdln-runtime
backend: { mode: in-process }
pipeline:
  - use: cap-intake
    with:
      mapping:
        - { from: "sourceData", to: "data" }
        - { from: "userCode", to: "code" }
  - use: cap-runtime
    with:
      executor: "wasmtime"
      limits: { cpu_ms: 1500, memory_mb: 512, wall_ms: 2500 }
      code_input: "code"
      data_input: "data"
      webhook_binding: "EXECUTOR_URL"
      executor_allow: ["wasmtime"]
  - use: cap-policy
    with:
      rules:
        - { kind: "EXIST", paths: ["data"] }
      decision_on_fail: "DENY"
  - use: cap-enrich
    with:
      drivers:
        - { kind: "status-page" }
  - use: cap-transport
    with:
      node: "did:ubl:tdln-runtime#key-1"
outputs: { format: "json", fields: ["decision","receipt_cid","url_rica","artifacts"] }
