version: 1
name: llm-engine
backend: { mode: in-process }
pipeline:
  - use: cap-intake
    with:
      mapping:
        - { from: "prompt", to: "query" }
  - use: policy.light
    with:
      rules:
        - { kind: "EXIST", paths: ["query"] }
  - use: cap-intake
    with:
      defaults: {}
  - use: cap-llm
    with:
      model_binding: "LLM_MODEL"
      prompt_cid: "0000000000000000000000000000000000000000000000000000000000000000"
      max_tokens: 4096
      inputs:
        query: "query"
      produce: ["artifact:json:analysis"]
  - use: cap-enrich
    with:
      drivers:
        - { kind: "status-page" }
  - use: cap-transport
    with:
      node: "did:ubl:llm-engine#key-1"
outputs: { format: "json", fields: ["artifacts","metrics","receipt_cid","url_rica"] }
